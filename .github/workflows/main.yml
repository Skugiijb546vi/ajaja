name: Direct_To_HuggingFace_CDN
on:
  workflow_dispatch:
    inputs:
      video_url:
        description: 'Ù„ÛŒÙ†Ú©ÛŒ Ú¤ÛŒØ¯ÛŒÛ†Ú©Û• (Ø¨Û• ØªÛ†Ú©Ù†Û•Ú©Û•ÛŒÛ•ÙˆÛ•)'
        required: true
      file_name:
        description: 'Ù†Ø§ÙˆÛŒ ÙØ§ÛŒÙ„Û•Ú©Û• (Ø¨Û• .mp4 Ú©Û†ØªØ§ÛŒÛŒ Ø¨ÛØª)'
        required: true
        default: 'video.mp4'

jobs:
  upload_job:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ—ï¸ Setup Tools
        run: |
          sudo apt-get update -qq
          python -m pip install -U pip huggingface_hub

      - name: â¬‡ï¸ Download Video (Bypass as Mobile App)
        run: |
          # Ù„ÛØ±Û•Ø¯Ø§ Ø®Û†Ù…Ø§Ù† ÙˆÛ•Ú© Ù¾Ù„Û•ÛŒÛ•Ø±ÛŒ Ù…Û†Ø¨Ø§ÛŒÙ„ (ExoPlayer) Ø¯Û•Ù†Ø§Ø³ÛÙ†ÛŒÙ† Ú©Û• Ø²Û†Ø±Ø¨Û•ÛŒ Ø¦Û•Ù¾Û•Ú©Ø§Ù† Ø¨Û•Ú©Ø§Ø±ÛŒØ¯ÛÙ†Ù†
          curl -L -k --http1.1 \
               -A "ExoPlayerDemo/2.18.1 (Linux; Android 12) ExoPlayerLib/2.18.1" \
               -H "Connection: keep-alive" \
               -o "video_temp.mp4" \
               "${{ inputs.video_url }}"
               
          echo "==== Ø²Ø§Ù†ÛŒØ§Ø±ÛŒ ÙØ§ÛŒÙ„ ===="
          ls -lh video_temp.mp4

      - name: ğŸš€ Upload to Hugging Face
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
          FILE_NAME: ${{ inputs.file_name }}
        run: |
          python3 -c "
          import os
          from huggingface_hub import HfApi
          
          token = os.getenv('HF_TOKEN')
          target_name = os.getenv('FILE_NAME', 'video.mp4')
          repo_id = 'Sarkoakram/sarko761'
          
          # Ù¾Ø´Ú©Ù†ÛŒÙ† Ú©Û• Ø¦Ø§ÛŒØ§ ÙØ§ÛŒÙ„Û•Ú©Û• Ø¨Û•ØªØ§ÚµÛ• ÛŒØ§Ù† Ù†Ø§
          if not os.path.exists('video_temp.mp4') or os.path.getsize('video_temp.mp4') < 1000:
              print('âŒ Ù‡Û•ÚµÛ•: Ú¤ÛŒØ¯ÛŒÛ†Ú©Û• Ø¯Ø§Ù†Û•Ø¨Û•Ø²ÛŒ (ÙØ§ÛŒÙ„Û•Ú©Û• Ø³ÙØ± Ø¨Ø§ÛŒØªÛ•). Ø³ÛØ±Ú¤Û•Ø±Û•Ú©Û• Ù‡ÛØ´ØªØ§ Ú•ÛÚ¯Ø±ÛŒ Ø¯Û•Ú©Ø§Øª Ø¨Û•Ù‡Û†ÛŒ Ø¬ÛŒØ§ÙˆØ§Ø²ÛŒ IP!')
              with open('video_temp.mp4', 'r', errors='ignore') as f:
                  print('Ù†Ø§ÙˆÛ•Ú•Û†Ú©ÛŒ Ø³ÛØ±Ú¤Û•Ø±:', f.read(200))
              exit(1)

          api = HfApi()
          print(f'ğŸ“¤ Ø¯Û•Ù†ÛØ±Ø¯Ø±ÛØª Ø¨Û† Hugging Face: {target_name}...')
          
          api.upload_file(
              path_or_fileobj='video_temp.mp4',
              path_in_repo=target_name,
              repo_id=repo_id,
              repo_type='dataset',
              token=token
          )
          print('âœ… Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒ Ù†ÛØ±Ø¯Ø±Ø§!')
          "
