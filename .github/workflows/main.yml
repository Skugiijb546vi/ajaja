name: Direct_To_HuggingFace_CDN
on:
  workflow_dispatch:
    inputs:
      video_url:
        description: 'Ù„ÛŒÙ†Ú©ÛŒ Ú¤ÛŒØ¯ÛŒÛ†Ú©Û• (Ø¨Û• ØªÛ†Ú©Ù†Û•Ú©Û•ÛŒÛ•ÙˆÛ•)'
        required: true
      file_name:
        description: 'Ù†Ø§ÙˆÛŒ ÙØ§ÛŒÙ„Û•Ú©Û• Ù„Û•Ù†Ø§Ùˆ Hugging Face'
        required: true
        default: 'video.mp4'
      referer_url:
        description: 'Ø³Û•Ø±Ú†Ø§ÙˆÛ•ÛŒ Ù„ÛŒÙ†Ú©Û•Ú©Û•'
        required: true
        default: 'http://45.155.90.34:8080/'

jobs:
  upload_job:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ—ï¸ Setup Tools
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y ffmpeg aria2 -qq
          python -m pip install -U pip yt-dlp huggingface_hub

      - name: â¬‡ï¸ Download Video (High Speed & Bypass)
        run: |
          # Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Ø§Ù†ÛŒ yt-dlp Ù„Û•Ú¯Û•Úµ aria2c Ø¨Û† Ø¯Ø§Ú¯Ø±ØªÙ†ÛŒ Ø®ÛØ±Ø§ Ùˆ ØªÛÙ¾Û•Ú•Ø§Ù†Ø¯Ù†ÛŒ Ø¨Ù„Û†Ú©
          yt-dlp \
            --user-agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36" \
            --add-header "Referer: ${{ inputs.referer_url }}" \
            --add-header "Origin: ${{ inputs.referer_url }}" \
            --no-check-certificate \
            --external-downloader aria2c \
            --external-downloader-args "-x 16 -s 16 -k 1M" \
            -o "video.mp4" \
            "${{ inputs.video_url }}"

      - name: ğŸš€ Upload to Hugging Face
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          python3 -c "
          import os
          from huggingface_hub import HfApi
          
          token = os.getenv('HF_TOKEN')
          if not token:
              print('âŒ Error: HF_TOKEN is missing in GitHub Secrets!')
              exit(1)
              
          if not os.path.exists('video.mp4'):
              print('âŒ Error: Video file not found! Download failed.')
              exit(1)
              
          api = HfApi()
          repo_id = 'Sarkoakram/sarko761'
          file_name = '${{ inputs.inputs.file_name if hasattr(inputs, \"file_name\") else \"video.mp4\" }}' # Fixed reference
          
          # Ø¯ÚµÙ†ÛŒØ§Ø¨ÙˆÙˆÙ†Û•ÙˆÛ• Ù„Û• Ù†Ø§ÙˆÛŒ ÙØ§ÛŒÙ„Û•Ú©Û• Ø¦Û•Ú¯Û•Ø± Ø¨Û•ØªØ§Úµ Ø¨ÙˆÙˆ
          target_name = '${{ inputs.file_name }}'
          if not target_name.endswith('.mp4'):
              target_name += '.mp4'

          print(f'ğŸ“¤ Sending to Hugging Face: {target_name}...')
          
          api.upload_file(
              path_or_fileobj='video.mp4',
              path_in_repo=target_name,
              repo_id=repo_id,
              repo_type='dataset',
              token=token
          )
          print('âœ… Done! Check your Hugging Face repo.')
          "
